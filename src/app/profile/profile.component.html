<app-header [loggedIn]="isLoggedIn" (logout)="logout()"></app-header>

<div class="profile-container">
  <div class="profile-card">
    <div class="profile-header">
      <h2>{{ profile.full_name || profile.username || "My Profile" }}</h2>
      <div class="header-buttons">
        <button class="edit-btn" (click)="toggleEdit()" *ngIf="!isEditing">
          <span class="edit-icon">‚úèÔ∏è</span> Edit Profile
        </button>
        <div class="action-buttons" *ngIf="isEditing">
          <button class="save-btn" (click)="saveProfile()" [disabled]="loading">{{ loading ? 'Saving...' : 'Save Changes' }}</button>
          <button class="cancel-btn" (click)="toggleEdit()" [disabled]="loading">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Success Message -->
    <div class="success-message" *ngIf="successMessage">{{ successMessage }}</div>

    <!-- Error Message -->
    <div class="error-message" *ngIf="errorMessage">{{ errorMessage }}</div>

    <!-- Loading Indicator -->
    <div class="loading-message" *ngIf="loading && !successMessage && !errorMessage">Saving profile...</div>



    <div class="profile-content">
      <!-- Photo Upload Section -->
      <div class="profile-section">
        <div class="field-group">
          <label class="field-label">Profile Photo</label>
          <div class="photo-upload-container">
            <div class="photo-preview-wrapper">
              <div class="photo-preview" *ngIf="profile.photo || photoPreview">
                <img [src]="profile.photo || photoPreview" alt="Profile Photo" class="profile-photo" />
                <button
                  type="button"
                  class="remove-photo-btn"
                  *ngIf="isEditing"
                  (click)="removePhoto()"
                  title="Remove photo"
                >
                  √ó
                </button>
              </div>
              <div class="photo-placeholder" *ngIf="!profile.photo && !photoPreview">
                <span class="placeholder-icon">üë§</span>
                <span class="placeholder-text">No Photo</span>
              </div>
            </div>
            <div class="photo-upload-controls" *ngIf="isEditing">
              <input
                type="file"
                id="photo-input"
                name="photo"
                accept="image/*"
                (change)="onPhotoSelected($event)"
                class="photo-input"
              />
              <label for="photo-input" class="photo-upload-btn">
                <span class="upload-icon">üì∑</span>
                {{ photoPreview ? 'Change Photo' : 'Upload Photo' }}
              </label>
              <p class="photo-hint">Max size: 5MB (JPG, PNG, GIF)</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Username/Email Section -->
      <div class="
      profile-section">
        <div class="field-group">
          <label for="username" class="field-label">
            Full Name <span class="required">*</span>
          </label>
          <input
            type="text"
            id="full_name"
            name="full_name"
            [(ngModel)]="profile.full_name"
            [readonly]="!isEditing"
            class="field-input"
            placeholder="Enter your full name (First Name Father Name Surname)"
            required
          />
        </div>

        <div class="field-group">
          <label for="email" class="field-label">
            Email ID <span class="required">*</span>
          </label>
          <input
            type="email"
            id="email"
            name="email"
            [(ngModel)]="profile.email"
            [readonly]="!isEditing"
            class="field-input"
            placeholder="Enter your email address"
            required
          />
        </div>

        <div class="field-group">
          <label for="role" class="field-label">Role</label>
          <select
            id="role"
            name="role"
            [(ngModel)]="profile.role"
            [disabled]="!isEditing"
            class="field-input"
          >
            <option value="user">User</option>
            <option value="admin">Admin</option>
            <option value="moderator">Moderator</option>
          </select>
        </div>

        <div class="field-group">
          <label for="language" class="field-label">Language</label>
          <select
            id="language"
            name="language"
            [(ngModel)]="profile.language"
            [disabled]="!isEditing"
            class="field-input"
          >
            <option value="en">English</option>
            <option value="hi">Hindi</option>
            <option value="mr">Marathi</option>
          </select>
        </div>

        <div class="field-group">
          <label class="field-label">Dark Mode</label>
          <div class="toggle-container">
            <input
              type="checkbox"
              id="darkMode"
              name="darkMode"
              [(ngModel)]="profile.is_dark_mode"
              [disabled]="!isEditing"
              class="toggle-input"
            />
            <label for="darkMode" class="toggle-label"></label>
            <span class="toggle-text">
              {{ profile.is_dark_mode ? 'Enabled' : 'Disabled' }}
            </span>
          </div>
        </div>
      </div>

      <!-- Contact Number Section -->
      <div class="profile-section">
        <div class="field-group">
          <label for="contactNo" class="field-label">Contact Number</label>
          <input
            type="tel"
            id="contactNo"
            name="contactNo"
            [(ngModel)]="profile.contactNo"
            [readonly]="!isEditing"
            class="field-input"
            placeholder="Enter your contact number"
          />
        </div>
      </div>

      <!-- Education Section -->
      <div class="profile-section">
        <h3 class="section-title">Education Details</h3>
        <div class="field-group">
          <label for="education" class="field-label">
            Education Level <span class="required">*</span>
          </label>
          <select
            id="education"
            name="education"
            [(ngModel)]="profile.education"
            [disabled]="!isEditing"
            class="field-input"
            required
          >
            <option value="">Select Education Level</option>
            <option value="High School">High School</option>
            <option value="Diploma">Diploma</option>
            <option value="Bachelor's Degree">Bachelor's Degree</option>
            <option value="Master's Degree">Master's Degree</option>
            <option value="PhD">PhD</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div class="field-group">
          <label for="degree" class="field-label">
            Degree/Course <span class="required">*</span>
          </label>
          <input
            type="text"
            id="degree"
            name="degree"
            [(ngModel)]="profile.degree"
            [readonly]="!isEditing"
            class="field-input"
            placeholder="e.g., B.Tech Computer Science, MBA, etc."
            required
          />
        </div>
        <div class="field-group">
          <label for="institution" class="field-label">
            Institution/University <span class="required">*</span>
          </label>
          <input
            type="text"
            id="institution"
            name="institution"
            [(ngModel)]="profile.institution"
            [readonly]="!isEditing"
            class="field-input"
            placeholder="Enter your college/university name"
            required
          />
        </div>
        <div class="field-group">
          <label for="graduationYear" class="field-label">
            Year of Graduation <span class="required">*</span>
          </label>
          <input
            type="number"
            id="graduationYear"
            name="graduationYear"
            [(ngModel)]="profile.graduationYear"
            [readonly]="!isEditing"
            class="field-input"
            placeholder="e.g., 2023"
            min="1950"
            max="2030"
            required
          />
        </div>
      </div>

      <!-- Address Section -->
      <div class="profile-section">
        <h3 class="section-title">Address Details</h3>
        <div class="field-group">
          <label for="address" class="field-label">
            Address Line <span class="required">*</span>
          </label>
          <textarea
            id="address"
            name="address"
            [(ngModel)]="profile.address"
            [readonly]="!isEditing"
            class="field-textarea"
            placeholder="Enter your address line"
            rows="2"
            required
          ></textarea>
        </div>
        <div class="address-grid">
          <div class="field-group">
            <label for="street" class="field-label">
              Street <span class="required">*</span>
            </label>
            <input
              type="text"
              id="street"
              name="street"
              [(ngModel)]="profile.street"
              [readonly]="!isEditing"
              class="field-input"
              placeholder="Street name"
              required
            />
          </div>
          <div class="field-group">
            <label for="city" class="field-label">
              City <span class="required">*</span>
            </label>
            <input
              type="text"
              id="city"
              name="city"
              [(ngModel)]="profile.city"
              [readonly]="!isEditing"
              class="field-input"
              placeholder="City"
              required
            />
          </div>
          <div class="field-group">
            <label for="state" class="field-label">
              State <span class="required">*</span>
            </label>
            <input
              type="text"
              id="state"
              name="state"
              [(ngModel)]="profile.state"
              [readonly]="!isEditing"
              class="field-input"
              placeholder="State/Province"
              required
            />
          </div>
          <div class="field-group">
            <label for="country" class="field-label">
              Country <span class="required">*</span>
            </label>
            <select
              id="country"
              name="country"
              [(ngModel)]="profile.country"
              [disabled]="!isEditing"
              class="field-input"
              required
            >
              <option value="">Select Country</option>
              <option value="India">India</option>
              <option value="United States">United States</option>
              <option value="United Kingdom">United Kingdom</option>
              <option value="Canada">Canada</option>
              <option value="Australia">Australia</option>
              <option value="Germany">Germany</option>
              <option value="France">France</option>
              <option value="Japan">Japan</option>
              <option value="China">China</option>
              <option value="Brazil">Brazil</option>
              <option value="Russia">Russia</option>
              <option value="South Africa">South Africa</option>
              <option value="Mexico">Mexico</option>
              <option value="Italy">Italy</option>
              <option value="Spain">Spain</option>
              <option value="Netherlands">Netherlands</option>
              <option value="Switzerland">Switzerland</option>
              <option value="Sweden">Sweden</option>
              <option value="Norway">Norway</option>
              <option value="Denmark">Denmark</option>
              <option value="Singapore">Singapore</option>
              <option value="South Korea">South Korea</option>
              <option value="Thailand">Thailand</option>
              <option value="Malaysia">Malaysia</option>
              <option value="Indonesia">Indonesia</option>
              <option value="Philippines">Philippines</option>
              <option value="Vietnam">Vietnam</option>
              <option value="Bangladesh">Bangladesh</option>
              <option value="Pakistan">Pakistan</option>
              <option value="Sri Lanka">Sri Lanka</option>
              <option value="Nepal">Nepal</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="field-group">
            <label for="pincode" class="field-label">
              Pincode <span class="required">*</span>
            </label>
            <input
              type="text"
              id="pincode"
              name="pincode"
              [(ngModel)]="profile.pincode"
              [readonly]="!isEditing"
              class="field-input"
              placeholder="Postal/Zip code"
              maxlength="10"
              required
            />
          </div>
        </div>
      </div>


    </div>
  </div>
</div>
