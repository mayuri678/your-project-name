<div class="password-management" [class.dark-theme]="isDarkMode">
  <div class="header">
    <h2>ğŸ”‘ Password Management</h2>
    <div class="header-actions">
      <button class="theme-toggle" (click)="toggleDarkMode()" title="Toggle Dark Mode">
        {{ isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™' }}
      </button>
      <button class="btn-primary" (click)="openResetModal()">Reset User Password</button>
    </div>
  </div>

  <!-- Users List -->
  <div class="users-section">
    <h3>All Users</h3>
    <div class="users-table">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Status</th>
            <th>Last Login</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users">
            <td>{{ user.name }}</td>
            <td>{{ user.email }}</td>
            <td>{{ user.phone }}</td>
            <td>
              <span class="status-badge" [class]="user.status">
                {{ user.status | titlecase }}
              </span>
            </td>
            <td>{{ user.lastLogin | date:'short' }}</td>
            <td class="actions">
              <button 
                class="btn-edit" 
                (click)="openEditModal(user.id)"
                title="Edit User">
                âœï¸
              </button>
              <button 
                class="btn-reset" 
                (click)="openResetModal(user.id)"
                title="Reset Password">
                ğŸ”‘
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Templates List -->
  <div class="templates-section">
    <h3>ğŸ“‹ Templates Management</h3>
    <div class="templates-table">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Category</th>
            <th>Color</th>
            <th>Layout</th>
            <th>Features</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let template of templates">
            <td>{{ template.name }}</td>
            <td>{{ template.category }}</td>
            <td>
              <span class="color-badge" [style.background-color]="template.color.toLowerCase()">{{ template.color }}</span>
            </td>
            <td>{{ template.layout }}</td>
            <td>{{ template.features.join(', ') }}</td>
            <td class="actions">
              <button 
                class="btn-edit" 
                (click)="openTemplateEditModal(template)"
                title="Edit Template">
                âœï¸ Edit
              </button>
              <button 
                class="btn-add" 
                (click)="openAddTemplateModal()"
                title="Add Template">
                â• Add
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>


  <div class="requests-section">
    <h3>Password Reset Requests</h3>
    <div class="requests-table">
      <table>
        <thead>
          <tr>
            <th>User</th>
            <th>Email</th>
            <th>Request Date</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let request of passwordRequests">
            <td>{{ request.userName }}</td>
            <td>{{ request.userEmail }}</td>
            <td>{{ request.requestDate | date:'short' }}</td>
            <td>
              <span class="status-badge" [class]="request.status">
                {{ request.status | titlecase }}
              </span>
            </td>
            <td class="actions">
              <button 
                class="btn-reset" 
                (click)="sendResetLink(request.userEmail)"
                *ngIf="request.status === 'pending'">
                Send Link
              </button>
              <button 
                class="btn-complete" 
                (click)="updateRequestStatus(request.userId, 'completed')"
                *ngIf="request.status === 'pending'">
                Mark Complete
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <h3>Quick Actions</h3>
    <div class="action-cards">
      <div class="action-card">
        <div class="card-icon">ğŸ”„</div>
        <h4>Bulk Password Reset</h4>
        <p>Reset passwords for multiple users</p>
        <button class="card-btn" (click)="openBulkResetModal()">Start Bulk Reset</button>
      </div>
      <div class="action-card">
        <div class="card-icon">ğŸ“§</div>
        <h4>Email Templates</h4>
        <p>Manage password reset email templates</p>
        <button class="card-btn" (click)="openTemplateModal()">Edit Templates</button>
      </div>
      <div class="action-card">
        <div class="card-icon">âš™ï¸</div>
        <h4>Password Policy</h4>
        <p>Configure password requirements</p>
        <button class="card-btn">Edit Policy</button>
      </div>
    </div>
  </div>

  <!-- Password Reset Modal -->
  <div class="modal-overlay" *ngIf="showResetModal" (click)="closeResetModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Reset User Password</h3>
        <button class="close-btn" (click)="closeResetModal()">âœ•</button>
      </div>

      <form (ngSubmit)="resetPassword()" class="reset-form">
        <div class="form-group">
          <label>User Email *</label>
          <input 
            type="email" 
            [(ngModel)]="resetForm.email" 
            name="email"
            placeholder="Enter user email"
            required>
        </div>

        <div class="form-group">
          <label>New Password *</label>
          <div class="password-input">
            <input 
              type="text" 
              [(ngModel)]="resetForm.newPassword" 
              name="newPassword"
              placeholder="Enter new password"
              required>
            <button type="button" class="generate-btn" (click)="generatePassword()">
              ğŸ² Generate
            </button>
          </div>
          <small>Password must be at least 6 characters long</small>
        </div>

        <div class="form-group">
          <label>Confirm Password *</label>
          <input 
            type="text" 
            [(ngModel)]="resetForm.confirmPassword" 
            name="confirmPassword"
            placeholder="Confirm new password"
            required>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="closeResetModal()">Cancel</button>
          <button type="submit" class="btn-reset-submit">Reset Password</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Bulk Reset Modal -->
  <div class="modal-overlay" *ngIf="showBulkResetModal" (click)="closeBulkResetModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>ğŸ”„ Bulk Password Reset</h3>
        <button class="close-btn" (click)="closeBulkResetModal()">âœ•</button>
      </div>

      <form (ngSubmit)="bulkPasswordReset()" class="bulk-form">
        <div class="form-group">
          <label>User Emails (one per line) *</label>
          <textarea 
            [(ngModel)]="bulkResetForm.userEmails" 
            name="userEmails"
            rows="8"
            placeholder="user1@email.com&#10;user2@email.com&#10;user3@email.com"
            required></textarea>
        </div>

        <div class="form-group">
          <label>
            <input 
              type="checkbox" 
              [(ngModel)]="bulkResetForm.sendEmail" 
              name="sendEmail">
            Send email notification to users
          </label>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="closeBulkResetModal()">Cancel</button>
          <button type="submit" class="btn-reset-submit">Reset All Passwords</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Edit User Modal -->
  <div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Edit User Information</h3>
        <button class="close-btn" (click)="closeEditModal()">âœ•</button>
      </div>

      <form (ngSubmit)="updateUserInfo()" class="edit-form">
        <div class="form-group">
          <label>Full Name *</label>
          <input 
            type="text" 
            [(ngModel)]="editForm.name" 
            name="name"
            placeholder="Enter full name"
            required>
        </div>

        <div class="form-group">
          <label>Email *</label>
          <input 
            type="email" 
            [(ngModel)]="editForm.email" 
            name="email"
            placeholder="Enter email address"
            required>
        </div>

        <div class="form-group">
          <label>Phone Number</label>
          <input 
            type="tel" 
            [(ngModel)]="editForm.phone" 
            name="phone"
            placeholder="Enter phone number">
        </div>

        <div class="form-group">
          <label>Status *</label>
          <select [(ngModel)]="editForm.status" name="status" required>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="closeEditModal()">Cancel</button>
          <button type="submit" class="btn-save">Save Changes</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Template Edit Modal -->
  <div class="modal-overlay" *ngIf="showTemplateModal" (click)="closeTemplateModal()">
    <div class="modal-content template-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>ğŸ“§ Edit Email Template</h3>
        <button class="close-btn" (click)="closeTemplateModal()">âœ•</button>
      </div>

      <form (ngSubmit)="saveTemplate()" class="template-form">
        <div class="form-group">
          <label>Email Subject *</label>
          <input 
            type="text" 
            [(ngModel)]="emailTemplate.subject" 
            name="subject"
            placeholder="Enter email subject"
            required>
        </div>

        <div class="form-group">
          <label>Email Body *</label>
          <textarea 
            [(ngModel)]="emailTemplate.body" 
            name="body"
            rows="12"
            placeholder="Enter email template body"
            required></textarea>
          <small>Available variables: {{userName}}, {{newPassword}}</small>
        </div>

        <div class="template-preview">
          <h4>Preview:</h4>
          <div class="preview-content">
            <strong>Subject:</strong> {{ emailTemplate.subject }}<br><br>
            <div [innerHTML]="emailTemplate.body.replace('{{userName}}', 'John Doe').replace('{{newPassword}}', 'TempPass123') | slice:0:200"></div>
            <span *ngIf="emailTemplate.body.length > 200">...</span>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="closeTemplateModal()">Cancel</button>
          <button type="submit" class="btn-save">Save Template</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Template Information Edit Modal -->
  <div class="modal-overlay" *ngIf="showTemplateEditModal" (click)="closeTemplateEditModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>ğŸ“‹ Edit Template Information</h3>
        <button class="close-btn" (click)="closeTemplateEditModal()">âœ•</button>
      </div>

      <form (ngSubmit)="saveTemplateChanges()" class="template-edit-form">
        <div class="form-group">
          <label>Template Name *</label>
          <input 
            type="text" 
            [(ngModel)]="templateEditForm.name" 
            name="name"
            placeholder="Enter template name"
            required>
        </div>

        <div class="form-group">
          <label>Category *</label>
          <input 
            type="text" 
            [(ngModel)]="templateEditForm.category" 
            name="category"
            placeholder="Enter category"
            required>
        </div>

        <div class="form-group">
          <label>Color *</label>
          <select [(ngModel)]="templateEditForm.color" name="color" required>
            <option value="Blue">Blue</option>
            <option value="Red">Red</option>
            <option value="Green">Green</option>
            <option value="Yellow">Yellow</option>
            <option value="Purple">Purple</option>
          </select>
        </div>

        <div class="form-group">
          <label>Layout *</label>
          <select [(ngModel)]="templateEditForm.layout" name="layout" required>
            <option value="1 Column">1 Column</option>
            <option value="2 Column">2 Column</option>
            <option value="3 Column">3 Column</option>
            <option value="Grid">Grid</option>
          </select>
        </div>

        <div class="form-group">
          <label>Features (comma separated)</label>
          <textarea 
            [(ngModel)]="templateEditForm.features" 
            name="features"
            rows="3"
            placeholder="Feature 1, Feature 2, Feature 3"></textarea>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="closeTemplateEditModal()">Cancel</button>
          <button type="submit" class="btn-save">Save Changes</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add Template Modal -->
  <div class="modal-overlay" *ngIf="showAddTemplateModal" (click)="closeAddTemplateModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>â• Add New Template</h3>
        <button class="close-btn" (click)="closeAddTemplateModal()">âœ•</button>
      </div>

      <form (ngSubmit)="addNewTemplate()" class="template-edit-form">
        <div class="form-group">
          <label>Template Name *</label>
          <input 
            type="text" 
            [(ngModel)]="addTemplateForm.name" 
            name="name"
            placeholder="Enter template name"
            required>
        </div>

        <div class="form-group">
          <label>Category *</label>
          <input 
            type="text" 
            [(ngModel)]="addTemplateForm.category" 
            name="category"
            placeholder="Enter category"
            required>
        </div>

        <div class="form-group">
          <label>Color *</label>
          <select [(ngModel)]="addTemplateForm.color" name="color" required>
            <option value="Blue">Blue</option>
            <option value="Red">Red</option>
            <option value="Green">Green</option>
            <option value="Yellow">Yellow</option>
            <option value="Purple">Purple</option>
          </select>
        </div>

        <div class="form-group">
          <label>Layout *</label>
          <select [(ngModel)]="addTemplateForm.layout" name="layout" required>
            <option value="1 Column">1 Column</option>
            <option value="2 Column">2 Column</option>
            <option value="3 Column">3 Column</option>
            <option value="Grid">Grid</option>
          </select>
        </div>

        <div class="form-group">
          <label>Features (comma separated)</label>
          <textarea 
            [(ngModel)]="addTemplateForm.features" 
            name="features"
            rows="3"
            placeholder="Feature 1, Feature 2, Feature 3"></textarea>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="closeAddTemplateModal()">Cancel</button>
          <button type="submit" class="btn-save">Add Template</button>
        </div>
      </form>
    </div>
  </div>
</div>