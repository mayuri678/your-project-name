<div class="password-management">
  <div class="header">
    <h2>ğŸ”‘ Password Management</h2>
    <div class="header-actions">
      <button class="btn-primary" (click)="openResetModal()">ğŸ”„ Reset User Password</button>
      <button class="btn-secondary" (click)="openBulkResetModal()">ğŸ“¦ Bulk Reset</button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card total">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-content">
        <div class="stat-number">{{ getRequestStats().total }}</div>
        <div class="stat-label">Total Requests</div>
      </div>
    </div>
    <div class="stat-card pending">
      <div class="stat-icon">â³</div>
      <div class="stat-content">
        <div class="stat-number">{{ getRequestStats().pending }}</div>
        <div class="stat-label">Pending</div>
      </div>
    </div>
    <div class="stat-card completed">
      <div class="stat-icon">âœ…</div>
      <div class="stat-content">
        <div class="stat-number">{{ getRequestStats().completed }}</div>
        <div class="stat-label">Completed</div>
      </div>
    </div>
    <div class="stat-card expired">
      <div class="stat-icon">âŒ</div>
      <div class="stat-content">
        <div class="stat-number">{{ getRequestStats().expired }}</div>
        <div class="stat-label">Expired</div>
      </div>
    </div>
  </div>

  <!-- All Users List -->
  <div class="users-section">
    <h3>ğŸ‘¥ All Users - Quick Password Reset</h3>
    <div class="users-table">
      <table>
        <thead>
          <tr>
            <th>User</th>
            <th>Email</th>
            <th>Status</th>
            <th>Last Login</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users">
            <td>
              <div class="user-info">
                <div class="user-avatar">{{ user.name.charAt(0) }}</div>
                <div class="user-details">
                  <div class="name">{{ user.name }}</div>
                  <div class="phone">{{ user.phone }}</div>
                </div>
              </div>
            </td>
            <td>{{ user.email }}</td>
            <td>
              <span class="status-badge" [class]="user.status">
                {{ user.status | titlecase }}
              </span>
            </td>
            <td>{{ user.lastLogin | date:'short' }}</td>
            <td class="actions">
              <button class="btn-reset" (click)="openResetModal(user.id)">ğŸ”„ Reset</button>
              <button class="btn-link" (click)="sendResetLink(user.email)">ğŸ“§ Send Link</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Password Reset Requests -->
  <div class="requests-section">
    <h3>ğŸ“‹ Password Reset Requests</h3>
    <div class="requests-table">
      <table>
        <thead>
          <tr>
            <th>User</th>
            <th>Email</th>
            <th>Request Date</th>
            <th>Status</th>
            <th>Reset Token</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let request of passwordRequests">
            <td>{{ request.userName }}</td>
            <td>{{ request.userEmail }}</td>
            <td>{{ request.requestDate | date:'short' }}</td>
            <td>
              <span class="status-badge" [class]="request.status">
                {{ request.status | titlecase }}
              </span>
            </td>
            <td>
              <span class="token" *ngIf="request.resetToken">{{ request.resetToken }}</span>
              <span class="no-token" *ngIf="!request.resetToken">-</span>
            </td>
            <td class="actions">
              <button 
                class="btn-link" 
                (click)="sendResetLink(request.userEmail)"
                *ngIf="request.status === 'pending'">
                ğŸ“§ Send Link
              </button>
              <button 
                class="btn-complete" 
                (click)="updateRequestStatus(request.id, 'completed')"
                *ngIf="request.status === 'pending'">
                âœ… Complete
              </button>
              <button 
                class="btn-expire" 
                (click)="updateRequestStatus(request.id, 'expired')"
                *ngIf="request.status === 'pending'">
                âŒ Expire
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <h3>ğŸš€ Quick Actions</h3>
    <div class="action-cards">
      <div class="action-card">
        <div class="card-icon">ğŸ”„</div>
        <h4>Bulk Password Reset</h4>
        <p>Reset passwords for multiple users at once</p>
        <button class="card-btn" (click)="openBulkResetModal()">Start Bulk Reset</button>
      </div>
      <div class="action-card">
        <div class="card-icon">ğŸ“§</div>
        <h4>Email Templates</h4>
        <p>Manage password reset email templates</p>
        <button class="card-btn">Edit Templates</button>
      </div>
      <div class="action-card">
        <div class="card-icon">âš™ï¸</div>
        <h4>Password Policy</h4>
        <p>Min: {{ passwordPolicy.minLength }} chars, Upper: {{ passwordPolicy.requireUppercase ? 'Yes' : 'No' }}</p>
        <button class="card-btn">Edit Policy</button>
      </div>
      <div class="action-card">
        <div class="card-icon">ğŸ”’</div>
        <h4>Security Audit</h4>
        <p>Review password security and user activity</p>
        <button class="card-btn">View Audit</button>
      </div>
    </div>
  </div>

  <!-- Password Reset Modal -->
  <div class="modal-overlay" *ngIf="showResetModal" (click)="closeResetModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>ğŸ”‘ Reset User Password</h3>
        <button class="close-btn" (click)="closeResetModal()">âœ•</button>
      </div>

      <form (ngSubmit)="resetPassword()" class="reset-form">
        <div class="form-group">
          <label>User Email *</label>
          <input 
            type="email" 
            [(ngModel)]="resetForm.email" 
            name="email"
            placeholder="Enter user email"
            required>
        </div>

        <div class="form-group">
          <label>New Password *</label>
          <div class="password-input">
            <input 
              type="text" 
              [(ngModel)]="resetForm.newPassword" 
              name="newPassword"
              placeholder="Enter new password"
              required>
            <button type="button" class="generate-btn" (click)="generatePassword()">
              ğŸ² Generate
            </button>
          </div>
          <div class="password-strength" *ngIf="resetForm.newPassword">
            Strength: <span [class]="getPasswordStrength(resetForm.newPassword).toLowerCase()">{{ getPasswordStrength(resetForm.newPassword) }}</span>
          </div>
          <small>Min {{ passwordPolicy.minLength }} chars, must include: uppercase, lowercase, numbers, special chars</small>
        </div>

        <div class="form-group">
          <label>Confirm Password *</label>
          <input 
            type="text" 
            [(ngModel)]="resetForm.confirmPassword" 
            name="confirmPassword"
            placeholder="Confirm new password"
            required>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="closeResetModal()">Cancel</button>
          <button type="submit" class="btn-reset-submit">ğŸ”„ Reset Password</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Bulk Reset Modal -->
  <div class="modal-overlay" *ngIf="showBulkResetModal" (click)="closeBulkResetModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>ğŸ“¦ Bulk Password Reset</h3>
        <button class="close-btn" (click)="closeBulkResetModal()">âœ•</button>
      </div>

      <form (ngSubmit)="bulkPasswordReset()" class="bulk-form">
        <div class="form-group">
          <label>User Emails (one per line) *</label>
          <textarea 
            [(ngModel)]="bulkResetForm.userEmails" 
            name="userEmails"
            rows="8"
            placeholder="user1@email.com&#10;user2@email.com&#10;user3@email.com"
            required></textarea>
          <small>Enter one email address per line</small>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input 
              type="checkbox" 
              [(ngModel)]="bulkResetForm.sendEmail" 
              name="sendEmail">
            <span class="checkmark"></span>
            Send reset links via email (if unchecked, passwords will be auto-generated)
          </label>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="closeBulkResetModal()">Cancel</button>
          <button type="submit" class="btn-bulk-submit">ğŸ“¦ Process Bulk Reset</button>
        </div>
      </form>
    </div>
  </div>
</div>