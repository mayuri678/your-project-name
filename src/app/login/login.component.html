<!-- Login Modal Backdrop -->
<div class="modal-backdrop" (click)="onClose()"></div>

<!-- Login Modal Container -->
<div class="modal-container login-card">
  <!-- Modal Header -->
  <div class="modal-header">
    <h3>{{ isRegisterMode ? 'Register' : 'Login' }}</h3>
    <button class="close-btn" (click)="onClose()">√ó</button>
  </div>

  <!-- Success Message -->
  <div class="success-message" *ngIf="successMessage">{{ successMessage }}</div>

  <!-- Login/Register Form -->
  <form (ngSubmit)="isRegisterMode ? onRegister() : onLogin()" #authForm="ngForm" novalidate>

    <!-- Name (only for registration) -->
    <label for="name" class="input-label" *ngIf="isRegisterMode">Name (Optional)</label>
    <input
      type="text"
      id="name"
      name="name"
      [(ngModel)]="name"
      *ngIf="isRegisterMode"
      class="input-field"
      placeholder="Your name"
    />

    <!-- Email/Phone -->
    <label for="email" class="input-label">Email or Username</label>
    <input
      type="text"
      id="email"
      name="email"
      [(ngModel)]="email"
      required
      class="input-field"
      [placeholder]="isRegisterMode ? 'Enter your email' : 'Enter email or username'"
    />

    <!-- Password -->
    <label for="password" class="input-label">Password</label>
    <div style="position: relative;">
      <input
        [type]="showPassword ? 'text' : 'password'"
        id="password"
        name="password"
        [(ngModel)]="password"
        required
        class="input-field"
        placeholder="Enter your password"
        [style.paddingRight]="!isRegisterMode ? '40px' : '12px'"
      />
      <!-- Password Toggle (only for login) -->
      <button type="button" class="password-toggle" *ngIf="!isRegisterMode" (click)="togglePasswordVisibility()">
        üëÅÔ∏è
      </button>
    </div>

    <!-- Forgot Password Link (only for login) -->
    <div class="forgot-password" *ngIf="!isRegisterMode">
      <button type="button" class="link-button forgot-btn" (click)="showForgotPasswordPopup()">
        üîë Forgot Password?
      </button>
    </div>

    <!-- Submit Button -->
    <button type="submit" class="accept-btn full">
      {{ isRegisterMode ? 'REGISTER' : 'LOGIN' }}
    </button>

    <!-- Error Message -->
    <div class="error" *ngIf="errorMessage">
      {{ errorMessage }}
      <div class="error-help" *ngIf="errorMessage.includes('No account found') || errorMessage.includes('Invalid email or password')">
        <p><strong>Don't have an account?</strong></p>
        <button type="button" class="link-button register-link" (click)="toggleMode()">
          Click here to Register
        </button>
      </div>
    </div>

    <!-- Toggle Mode Button -->
    <div class="toggle-mode">
      <button type="button" class="link-button" (click)="toggleMode()">
        {{ isRegisterMode ? 'Already have an account? Login' : "Don't have an account? Register" }}
      </button>
    </div>

    <!-- Cancel Button -->
    <button type="button" class="back-btn full" (click)="onClose()">BACK</button>

  </form>

  <!-- Forgot Password Popup -->
  <div class="forgot-popup" *ngIf="showForgotPopup">
    <div class="popup-content">
      <h4>Reset Password</h4>
      <p>Enter your email to receive OTP</p>
      <input type="email" [(ngModel)]="forgotEmail" placeholder="Enter your email" class="input-field">
      <div class="popup-buttons">
        <button type="button" class="accept-btn" (click)="sendOTP()" [disabled]="!forgotEmail.trim() || isLoading">
          {{ isLoading ? 'Redirecting...' : 'Send OTP' }}
        </button>
        <button type="button" class="back-btn" (click)="closeForgotPopup()">Cancel</button>
      </div>
      <div class="success-message" *ngIf="otpSent || successMessage">{{ successMessage || 'OTP sent to your email!' }}</div>
      <div class="error" *ngIf="errorMessage && showForgotPopup">{{ errorMessage }}</div>
    </div>
  </div>

  <!-- Modal Footer -->
  <div class="modal-footer">
    <span class="foot-text">By continuing you agree to our Terms & Privacy.</span>
  </div>
</div>

